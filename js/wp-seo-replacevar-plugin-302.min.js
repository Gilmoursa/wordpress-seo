!function(){"use strict";var a=function(){this.replaceVars=wpseoReplaceVarsL10n.replace_vars,this.categoriesRepository=[],this.currentCategories=[],YoastSEO.app.registerPlugin("replaceVariablePlugin",{status:"ready"}),this.registerModifications(),this.addCategoryEvents()};a.prototype.registerModifications=function(){var a=this.replaceVariablesPlugin.bind(this);YoastSEO.app.registerModification("content",a,"replaceVariablePlugin",10),YoastSEO.app.registerModification("title",a,"replaceVariablePlugin",10),YoastSEO.app.registerModification("snippet_title",a,"replaceVariablePlugin",10),YoastSEO.app.registerModification("snippet_meta",a,"replaceVariablePlugin",10),YoastSEO.app.registerModification("data_page_title",a,"replaceVariablePlugin",10),YoastSEO.app.registerModification("data_meta_desc",a,"replaceVariablePlugin",10)},a.prototype.replaceVariablesPlugin=function(a){return"undefined"!=typeof a&&(a=this.titleReplace(a),a=this.defaultReplace(a),a=this.parentReplace(a),a=this.doubleSepReplace(a),a=this.excerptReplace(a),a=this.categoryReplace(a)),a},a.prototype.addCategoryEvents=function(){var a=jQuery("#taxonomy-category");a.on("wpListAddEnd","#categorychecklist",function(){this.fetchTaxonomies(a)}.bind(this)),a.on("change","input[type=checkbox]",function(){this.fetchTaxonomies(a)}.bind(this)),this.fetchTaxonomies(a)},a.prototype.titleReplace=function(a){var b=YoastSEO.app.rawData.title;return a=a.replace(/%%title%%/g,b)},a.prototype.parentReplace=function(a){var b=document.getElementById("parent_id");return null!==b&&"undefined"!=typeof b.options&&b.options[b.selectedIndex].text!==wpseoReplaceVarsL10n.no_parent_text&&(a=a.replace(/%%parent_title%%/,b.options[b.selectedIndex].text)),a},a.prototype.doubleSepReplace=function(a){var b=YoastSEO.app.stringHelper.addEscapeChars(this.replaceVars.sep),c=new RegExp(b+" "+b,"g");return a=a.replace(c,this.replaceVars.sep)},a.prototype.excerptReplace=function(a){return"undefined"!=typeof YoastSEO.app.rawData.excerpt&&(a=a.replace(/%%excerpt_only%%/g,YoastSEO.app.rawData.excerpt),a=a.replace(/%%excerpt%%/g,YoastSEO.app.rawData.excerpt)),a},a.prototype.defaultReplace=function(a){return a=a.replace(/%%focuskw%%/g,YoastSEO.app.stringHelper.stripAllTags(YoastSEO.app.rawData.keyword)),jQuery.each(this.replaceVars,function(b,c){a=a.replace("%%"+b+"%%",c)}),a},a.prototype.categoryReplace=function(a){return a=a.replace(/%%category%%/g,jQuery.unique(this.currentCategories).join(", "))},a.prototype.fetchTaxonomies=function(a){if(void 0!==jQuery("#post_ID")){var b=jQuery(a).find("input:checked"),c=this.getUnparsedTaxonomies(b);if(c.length>0)return void jQuery.post(ajaxurl,{action:"wpseo_replace_category",_wpnonce:wpseoReplaceVarsL10n.wpseo_replace_vars_nonce,data:c},function(a){jQuery(a).each(function(a,b){this.categoriesRepository[b.id]=b.name}.bind(this)),this.setCurrentCategories(b),this.declareReloaded()}.bind(this),"json");this.setCurrentCategories(b),this.declareReloaded()}},a.prototype.getUnparsedTaxonomies=function(a){var b=[];return a.each(function(a,c){var d=jQuery(c).val();void 0===this.categoriesRepository[d]&&-1===jQuery.inArray(d,b)&&b.push(d)}.bind(this)),b},a.prototype.setCurrentCategories=function(a){this.currentCategories=[],a.each(function(a,b){this.currentCategories.push(this.categoriesRepository[jQuery(b).val()])}.bind(this))},a.prototype.declareReloaded=function(){YoastSEO.app.pluginReloaded("replaceVariablePlugin")},window.YoastReplaceVarPlugin=a}();